<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>üèúÔ∏è Desert Tribe - Camel Racing</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      font-family: 'Courier New', monospace;
      background: linear-gradient(to bottom, #f4a460 0%, #daa520 50%, #d2691e 100%);
      min-height: 100vh;
      overflow-x: hidden;
      touch-action: pan-y;
    }
    .container { max-width: 100%; margin: 0 auto; padding: 15px; }

    .title {
      color: #fff;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
      margin: 30px 0;
      text-align: center;
      animation: fadeIn 1s ease-in;
    }
    .title h1 { font-size: 2.5em; letter-spacing: 3px; }
    .title p { font-size: 1.1em; color: #ffe4b5; margin-top: 10px; }

    button {
      background: linear-gradient(45deg, #32CD32, #228B22);
      color: white;
      border: none;
      padding: 18px 30px;
      font-size: 1.2em;
      font-weight: bold;
      border-radius: 10px;
      cursor: pointer;
      margin: 10px 5px;
      width: 100%;
      max-width: 400px;
      touch-action: manipulation;
    }
    button:active { transform: scale(0.95); }

    /* Betting Screen */
    .betting-screen {
      display: none;
      max-width: 500px;
      margin: 0 auto;
    }

    .camel-select {
      background: rgba(139, 69, 19, 0.6);
      border: 3px solid #654321;
      border-radius: 12px;
      padding: 20px;
      margin: 15px 0;
      cursor: pointer;
      transition: all 0.3s;
    }

    .camel-select:active {
      transform: scale(0.98);
      border-color: #FFD700;
    }

    .camel-select.selected {
      border-color: #FFD700;
      background: rgba(255, 215, 0, 0.3);
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }

    .camel-select h3 {
      color: #FFD700;
      font-size: 1.5em;
      margin-bottom: 8px;
    }

    .bet-input {
      margin: 20px 0;
      padding: 15px;
      background: rgba(0,0,0,0.5);
      border-radius: 10px;
    }

    .bet-input input {
      width: 100%;
      padding: 15px;
      font-size: 1.3em;
      border: 2px solid #654321;
      border-radius: 8px;
      background: rgba(0,0,0,0.3);
      color: #FFD700;
      font-family: 'Courier New', monospace;
      text-align: center;
    }

    /* Race View */
    .race-view {
      display: none;
    }

    .race-viewport {
      width: 100%;
      height: 60vh;
      border: 4px solid #654321;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      background: #000;
      touch-action: none;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
    }

    .your-camel-indicator {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      color: #FFD700;
      padding: 10px 20px;
      border-radius: 20px;
      border: 2px solid #FFD700;
      font-size: 1.1em;
      z-index: 10;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }

    .race-info {
      background: rgba(0,0,0,0.8);
      border: 3px solid #FFD700;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      color: #FFD700;
    }

    .progress-container {
      background: rgba(0,0,0,0.6);
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
    }

    .progress-bar {
      width: 100%;
      height: 30px;
      background: rgba(0,0,0,0.5);
      border: 2px solid #FFD700;
      border-radius: 15px;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #32CD32, #FFD700);
      width: 0%;
      transition: width 0.3s;
      position: relative;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .position-display {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 1.2em;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (min-width: 768px) {
      .title h1 { font-size: 3em; }
      .race-viewport { height: 70vh; }
      button { width: auto; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="title">
      <h1>üèúÔ∏è DESERT TRIBE üê™</h1>
      <p>Epic Camel Racing</p>
    </div>

    <!-- Betting Screen -->
    <div class="betting-screen" id="bettingScreen">
      <h2 style="color: #FFD700; text-align: center; margin-bottom: 20px;">
        üé∞ PICK YOUR CAMEL üé∞
      </h2>

      <div id="camelList"></div>

      <div class="bet-input">
        <label style="color: #FFD700; display: block; margin-bottom: 10px; font-size: 1.1em;">
          üí∞ Your Gold: 1000
        </label>
        <input type="number" id="betAmount" placeholder="Bet amount..." value="100" min="10" max="1000">
      </div>

      <button onclick="startRace()" id="raceBtn" style="background: linear-gradient(45deg, #FFD700, #FF8C00);">
        üèÅ START RACE
      </button>
    </div>

    <!-- Race View -->
    <div class="race-view" id="raceView">
      <h2 style="color: #FFD700; text-align: center; margin-bottom: 15px;">
        üèÅ 10KM EPIC RACE üèÅ
      </h2>

      <div class="race-viewport" id="viewport">
        <canvas id="raceCanvas"></canvas>
        <div class="your-camel-indicator" id="indicator"></div>
      </div>

      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="position-display">
          <span style="color: #FFD700;">Position: <strong id="position">-</strong></span>
          <span style="color: #32CD32;">Progress: <strong id="progress">0%</strong></span>
        </div>
      </div>

      <div class="race-info" id="raceInfo"></div>

      <div id="raceStatus" style="text-align: center; margin: 20px 0;"></div>
      <button onclick="location.reload()" style="display: none;" id="resetBtn">üîÑ NEW RACE</button>
    </div>
  </div>

  <script>
    const CAMELS = [
      { id: 0, name: 'Desert Storm', color: '#8B4513', jockey: 'üë≥' },
      { id: 1, name: 'Sand Runner', color: '#D2691E', jockey: 'üßî' },
      { id: 2, name: 'Golden Wind', color: '#DAA520', jockey: 'üë®' },
      { id: 3, name: 'Oasis King', color: '#CD853F', jockey: 'üßë' },
      { id: 4, name: 'Dune Dancer', color: '#DEB887', jockey: 'üë¥' },
      { id: 5, name: 'Mirage Master', color: '#F4A460', jockey: 'üßì' },
      { id: 6, name: 'Swift Sands', color: '#BC8F8F', jockey: 'üë≤' },
      { id: 7, name: 'Thunder Hoof', color: '#A0522D', jockey: 'üßï' },
      { id: 8, name: 'Lightning Bolt', color: '#D2B48C', jockey: 'üë±' }
    ];

    let selectedCamel = null;
    let betAmount = 100;

    // Show betting screen
    function showBettingScreen() {
      document.querySelector('.title').style.display = 'block';
      document.getElementById('bettingScreen').style.display = 'block';

      const list = document.getElementById('camelList');
      list.innerHTML = CAMELS.map(camel => `
        <div class="camel-select" onclick="selectCamel(${camel.id})">
          <h3>${camel.jockey} ${camel.name}</h3>
          <div style="color: #FFF; margin-top: 5px;">Speed: ???  |  Form: ???</div>
        </div>
      `).join('');
    }

    function selectCamel(id) {
      selectedCamel = id;
      document.querySelectorAll('.camel-select').forEach((el, i) => {
        el.classList.toggle('selected', i === id);
      });
    }

    const RaceEngine = {
      canvas: null,
      ctx: null,
      viewport: null,
      camels: [],
      playerCamel: null,
      raceInProgress: false,
      winner: null,
      raceLength: 10000,
      cameraX: 0,
      canvasWidth: 15000,

      init() {
        this.viewport = document.getElementById('viewport');
        this.canvas = document.getElementById('raceCanvas');
        this.canvas.width = this.canvasWidth;
        this.canvas.height = this.viewport.clientHeight;
        this.ctx = this.canvas.getContext('2d');

        // Initialize camels
        this.camels = CAMELS.map((c, i) => ({
          ...c,
          x: 100,
          y: (this.canvas.height / 2) - 200 + (i * 45),
          baseSpeed: 3.5,
          todaysForm: 0.85 + Math.random() * 0.3,
          maxStamina: 80 + Math.random() * 40,
          staminaDrain: 0.04 + Math.random() * 0.03,
          consistency: 0.7 + Math.random() * 0.6,
          burstChance: 0.01 + Math.random() * 0.02,
          stumbleChance: 0.005 + Math.random() * 0.01,
          stamina: 100,
          speed: 3.5,
          distance: 0,
          isStumbling: false,
          stumbleTimer: 0,
          burstTimer: 0
        }));

        this.playerCamel = this.camels[selectedCamel];

        // Update indicator
        document.getElementById('indicator').innerHTML = `
          üéØ YOUR CAMEL: ${this.playerCamel.jockey} ${this.playerCamel.name}
        `;

        this.drawScene();
      },

      drawScene() {
        const ctx = this.ctx;
        const canvas = this.canvas;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Sky with clouds
        const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height * 0.4);
        gradient.addColorStop(0, '#87CEEB');
        gradient.addColorStop(0.5, '#B0D4F1');
        gradient.addColorStop(1, '#F4A460');
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height * 0.4);

        // Animated clouds
        for (let i = 0; i < 20; i++) {
          const cloudX = (i * 700) + (this.cameraX * 0.1);
          ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
          ctx.beginPath();
          ctx.arc(cloudX % canvas.width, 80 + Math.sin(i) * 30, 40, 0, Math.PI * 2);
          ctx.arc(cloudX % canvas.width + 30, 70 + Math.sin(i) * 30, 50, 0, Math.PI * 2);
          ctx.arc(cloudX % canvas.width + 60, 80 + Math.sin(i) * 30, 40, 0, Math.PI * 2);
          ctx.fill();
        }

        // Sun
        ctx.fillStyle = '#FFD700';
        ctx.beginPath();
        ctx.arc(200, 100, 50, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = 'rgba(255, 215, 0, 0.3)';
        ctx.beginPath();
        ctx.arc(200, 100, 70, 0, Math.PI * 2);
        ctx.fill();

        // Sand dunes - multiple layers with parallax
        const duneOffset1 = this.cameraX * 0.2;
        const duneOffset2 = this.cameraX * 0.4;
        const duneOffset3 = this.cameraX * 0.6;

        // Back layer
        ctx.fillStyle = '#F4A460';
        ctx.beginPath();
        ctx.moveTo(0, canvas.height * 0.4);
        for (let x = 0; x < canvas.width; x += 50) {
          const y = canvas.height * 0.4 + Math.sin((x - duneOffset1) * 0.005) * 100 + 120;
          ctx.lineTo(x, y);
        }
        ctx.lineTo(canvas.width, canvas.height);
        ctx.lineTo(0, canvas.height);
        ctx.fill();

        // Middle layer
        ctx.fillStyle = '#DEB887';
        ctx.beginPath();
        ctx.moveTo(0, canvas.height * 0.55);
        for (let x = 0; x < canvas.width; x += 50) {
          const y = canvas.height * 0.55 + Math.sin((x - duneOffset2) * 0.008) * 70 + 90;
          ctx.lineTo(x, y);
        }
        ctx.lineTo(canvas.width, canvas.height);
        ctx.lineTo(0, canvas.height);
        ctx.fill();

        // Front layer (racing surface)
        ctx.fillStyle = '#D2691E';
        ctx.beginPath();
        ctx.moveTo(0, canvas.height * 0.7);
        for (let x = 0; x < canvas.width; x += 50) {
          const y = canvas.height * 0.7 + Math.sin((x - duneOffset3) * 0.01) * 30 + 50;
          ctx.lineTo(x, y);
        }
        ctx.lineTo(canvas.width, canvas.height);
        ctx.lineTo(0, canvas.height);
        ctx.fill();

        // Racing track
        const trackY = canvas.height / 2 - 220;
        ctx.fillStyle = 'rgba(139, 69, 19, 0.3)';
        ctx.fillRect(0, trackY, canvas.width, 450);

        // Lane lines
        ctx.strokeStyle = 'rgba(210, 180, 140, 0.3)';
        ctx.lineWidth = 2;
        for (let i = 0; i < 10; i++) {
          ctx.beginPath();
          ctx.moveTo(0, trackY + (i * 45));
          ctx.lineTo(canvas.width, trackY + (i * 45));
          ctx.stroke();
        }

        // Distance markers with palm trees
        for (let i = 0; i <= this.raceLength; i += 1000) {
          const markerX = 100 + i;

          // Marker line
          ctx.fillStyle = 'rgba(255, 215, 0, 0.5)';
          ctx.fillRect(markerX, 0, 5, canvas.height);

          // Palm tree
          ctx.fillStyle = '#8B4513';
          ctx.fillRect(markerX - 8, canvas.height * 0.3, 16, 120);
          ctx.fillStyle = '#228B22';
          for (let p = 0; p < 6; p++) {
            ctx.beginPath();
            ctx.ellipse(markerX, canvas.height * 0.3 - 10, 40, 15, (Math.PI / 3) * p, 0, Math.PI * 2);
            ctx.fill();
          }

          // Distance text
          ctx.fillStyle = '#FFD700';
          ctx.font = 'bold 24px Courier';
          ctx.fillText(`${i/1000}km`, markerX - 30, 50);
        }

        // Finish line
        const finishX = 100 + this.raceLength;
        ctx.fillStyle = '#000';
        ctx.fillRect(finishX, 0, 120, canvas.height);
        for (let i = 0; i < 20; i++) {
          for (let j = 0; j < 3; j++) {
            if ((i + j) % 2 === 0) {
              ctx.fillStyle = '#fff';
              ctx.fillRect(finishX + (j * 40), i * 50, 40, 50);
            }
          }
        }

        // FINISH text
        ctx.fillStyle = '#FFD700';
        ctx.font = 'bold 60px Courier';
        ctx.save();
        ctx.translate(finishX + 60, canvas.height / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.fillText('FINISH', 0, 0);
        ctx.restore();
      },

      drawCamel(camel) {
        const ctx = this.ctx;
        const x = 100 + camel.distance;
        const y = camel.y;

        const wobble = camel.isStumbling ? Math.sin(Date.now() * 0.2) * 5 : Math.sin(camel.distance * 0.05) * 2;

        // Shadow
        ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
        ctx.beginPath();
        ctx.ellipse(x + 30, y + 50, 35, 10, 0, 0, Math.PI * 2);
        ctx.fill();

        // Camel body - bigger and more detailed
        ctx.fillStyle = camel.color;
        ctx.fillRect(x, y + wobble, 70, 45);
        ctx.fillRect(x + 60, y - 15 + wobble, 20, 35);
        ctx.fillRect(x + 70, y - 25 + wobble, 18, 18);

        // Humps
        ctx.beginPath();
        ctx.arc(x + 22, y + 5 + wobble, 18, Math.PI, 0);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(x + 48, y + 5 + wobble, 14, Math.PI, 0);
        ctx.fill();

        // Legs with animation
        const legBounce = Math.sin(camel.distance * 0.2) * 3;
        ctx.fillRect(x + 12, y + 45 + wobble + legBounce, 7, 22);
        ctx.fillRect(x + 30, y + 45 + wobble - legBounce, 7, 22);
        ctx.fillRect(x + 48, y + 45 + wobble - legBounce, 7, 22);
        ctx.fillRect(x + 66, y + 45 + wobble + legBounce, 7, 22);

        // Jockey
        ctx.font = '35px Arial';
        ctx.fillText(camel.jockey, x + 25, y + 25 + wobble);

        // Highlight player's camel
        if (camel === this.playerCamel) {
          ctx.strokeStyle = '#FFD700';
          ctx.lineWidth = 4;
          ctx.strokeRect(x - 10, y - 35 + wobble, 90, 110);

          ctx.fillStyle = '#FFD700';
          ctx.font = 'bold 16px Courier';
          ctx.fillText('‚≠ê YOU ‚≠ê', x + 5, y - 40);
        }

        // Name tag
        ctx.fillStyle = '#000';
        ctx.font = 'bold 14px Courier';
        ctx.fillText(camel.name, x, y - 10);

        // Status effects
        if (camel.burstTimer > 0) {
          ctx.fillStyle = '#FFD700';
          ctx.font = 'bold 20px Courier';
          ctx.fillText('‚ö°', x + 75, y - 5);
        }
        if (camel.isStumbling) {
          ctx.fillStyle = '#FF0000';
          ctx.font = 'bold 20px Courier';
          ctx.fillText('üí´', x + 75, y - 5);
        }
      },

      updateCamera() {
        // Center camera on player's camel
        const targetX = this.playerCamel.distance - (this.viewport.clientWidth / 2) + 100;
        this.cameraX = Math.max(0, Math.min(this.canvasWidth - this.viewport.clientWidth, targetX));
        this.canvas.style.transform = `translateX(-${this.cameraX}px)`;
      },

      updateUI() {
        const sorted = [...this.camels].sort((a, b) => b.distance - a.distance);
        const position = sorted.findIndex(c => c === this.playerCamel) + 1;
        const progress = ((this.playerCamel.distance / this.raceLength) * 100).toFixed(1);

        document.getElementById('position').textContent = position + ' / 9';
        document.getElementById('progress').textContent = progress + '%';
        document.getElementById('progressFill').style.width = progress + '%';

        let status = 'Running strong! üí™';
        if (this.playerCamel.burstTimer > 0) status = 'SPEED BURST! ‚ö°‚ö°‚ö°';
        if (this.playerCamel.isStumbling) status = 'Stumbled! üí´';
        if (this.playerCamel.stamina < 30) status = 'Low stamina! üòì';

        document.getElementById('raceInfo').innerHTML = `
          <div style="font-size: 1.2em; margin-bottom: 8px;">${status}</div>
          <div>Stamina: ${Math.floor(this.playerCamel.stamina)}% | Distance: ${(this.playerCamel.distance/1000).toFixed(2)}km</div>
        `;
      },

      startRace() {
        this.raceInProgress = true;
        this.animate();
      },

      animate() {
        if (!this.raceInProgress) return;

        this.drawScene();

        let raceFinished = false;

        this.camels.forEach(camel => {
          let speedMultiplier = camel.todaysForm;

          const staminaFactor = Math.max(0.6, camel.stamina / 100);
          speedMultiplier *= staminaFactor;

          const randomness = (Math.random() - 0.5) * (2 - camel.consistency);
          speedMultiplier *= (1 + randomness * 0.15);

          if (Math.random() < camel.burstChance && camel.burstTimer === 0) {
            camel.burstTimer = 60;
          }
          if (camel.burstTimer > 0) {
            speedMultiplier *= 1.6;
            camel.burstTimer--;
          }

          if (Math.random() < camel.stumbleChance && !camel.isStumbling) {
            camel.isStumbling = true;
            camel.stumbleTimer = 40;
          }
          if (camel.isStumbling) {
            speedMultiplier *= 0.3;
            camel.stumbleTimer--;
            if (camel.stumbleTimer <= 0) {
              camel.isStumbling = false;
            }
          }

          camel.speed = camel.baseSpeed * speedMultiplier;
          camel.stamina -= camel.staminaDrain;
          camel.stamina = Math.max(0, Math.min(100, camel.stamina));

          camel.distance += camel.speed;

          this.drawCamel(camel);

          if (camel.distance >= this.raceLength && !this.winner) {
            this.winner = camel;
            raceFinished = true;
          }
        });

        this.updateCamera();
        this.updateUI();

        if (raceFinished) {
          this.finishRace();
        } else {
          requestAnimationFrame(() => this.animate());
        }
      },

      finishRace() {
        this.raceInProgress = false;

        const sorted = [...this.camels].sort((a, b) => b.distance - a.distance);
        const playerPosition = sorted.findIndex(c => c === this.playerCamel) + 1;

        let resultMsg = '';
        let winnings = 0;

        if (playerPosition === 1) {
          winnings = betAmount * 8;
          resultMsg = `üèÜ YOU WON! +${winnings} GOLD! üèÜ`;
        } else if (playerPosition === 2) {
          winnings = betAmount * 3;
          resultMsg = `ü•à 2nd Place! +${winnings} GOLD!`;
        } else if (playerPosition === 3) {
          winnings = betAmount * 1.5;
          resultMsg = `ü•â 3rd Place! +${Math.floor(winnings)} GOLD!`;
        } else {
          resultMsg = `Position ${playerPosition}. Lost ${betAmount} gold üòî`;
        }

        document.getElementById('raceStatus').innerHTML = `
          <div style="color: #FFD700; font-size: 1.8em; margin-bottom: 15px;">
            ${this.winner.name} WINS!
          </div>
          <div style="color: ${playerPosition <= 3 ? '#32CD32' : '#FF6347'}; font-size: 1.4em;">
            ${resultMsg}
          </div>
        `;

        document.getElementById('resetBtn').style.display = 'block';
      }
    };

    function startRace() {
      if (selectedCamel === null) {
        alert('Pick a camel first!');
        return;
      }

      betAmount = parseInt(document.getElementById('betAmount').value) || 100;

      document.querySelector('.title').style.display = 'none';
      document.getElementById('bettingScreen').style.display = 'none';
      document.getElementById('raceView').style.display = 'block';

      RaceEngine.init();
      setTimeout(() => RaceEngine.startRace(), 1000);
    }

    // Show betting screen on load
    showBettingScreen();
  </script>
</body>
</html>
